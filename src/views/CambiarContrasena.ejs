<!DOCTYPE html>
<html lang="en">
<link rel="stylesheet" href="\css\bootstrap.css" media="all">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="\js\bootstrap.js"></script>
<link rel="stylesheet" href="\css\custom.css">
<script src="https://kit.fontawesome.com/c171c885c2.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
<script>
	function preventBack() { window.history.forward(); }
	setTimeout("preventBack()", 0);
	window.onunload = function () { null };
	function swalPass() {
		let timerInterval
		Swal.fire({
			title: 'Cambiando Contraseña...',
			timer: 2000,
			timerProgressBar: true,
			onBeforeOpen: () => {
				Swal.showLoading()
				timerInterval = setInterval(() => {
					const content = Swal.getContent()
					if (content) {
						const b = content.querySelector('b')
						if (b) {
							b.textContent = Swal.getTimerLeft()
						}
					}
				}, 100)
			},
			onClose: () => {
				clearInterval(timerInterval)
			}
		}).then((result) => {
			/* Read more about handling dismissals below */
			if (result.dismiss === Swal.DismissReason.timer) {

			}
		})
	}

</script>
<script>
	function comprobar1() {
		var todo = document.getElementById("pwd");
		var todo2 = document.getElementById("confpwd");

		if (todo.value !== todo2.value) {
			document.getElementById("isLogin").disabled = true;
			$('#isLogin').attr('disabled', 'disabled');
			

		} else {
			document.getElementById("isLogin").disabled = false;
			$('#isLogin').removeAttr('disabled');
		}
	}
</script>
<script>
	function comprobar2() {
		var todo = document.getElementById("pwd");
		var todo2 = document.getElementById("confpwd");

		if (todo.value !== todo2.value) {
			document.getElementById("isLogin").disabled = true;
			$('#isLogin').attr('disabled', 'disabled');
			Swal.fire({
				icon: 'error',
				title: 'Oops...',
				text: 'Las contraseñas no coinciden!',

			})

		} else {
			document.getElementById("isLogin").disabled = false;
			$('#isLogin').removeAttr('disabled');
		}
	}
</script>

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<link rel="icon" href="\images\favicon\favicon.ico" type="image/x-icon" />
	<title>Cambiar Contraseña</title>

</head>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
	<a class="navbar-brand" style="font-family: dkfont;cursor: default;color: white"> <img src="images\apple.png"
			width="30" height="30" class="d-inline-block align-top" alt=""> SantaFeria App</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
		aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarNav">
		<ul class="navbar-nav">
			<li class="nav-item dropdown" id="navInv">

				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false">
					Inventario
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					<a class="dropdown-item" href='/addProduct'>Agregar Producto</a>
					<a class="dropdown-item" href='/listProducts'>Lista de Productos</a>
				</div>
			</li>
			<li class="nav-item dropdown" id="navVen">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink2" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false">
					Ventas
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					<a class="dropdown-item" href='/makeSale'>Realizar Venta</a>
					<a class="dropdown-item" href='/listSales'>Lista de Ventas</a>
				</div>
			</li>

			<li class="nav-item dropdown" id="navAdm">
				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink3" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false">
					Administrador
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					<a class="dropdown-item" href='/addUser'>Agregar Usuario</a>
					<a class="dropdown-item" href='/listUsers'>Lista de Usuarios</a>
					<a class="dropdown-item" href='/reportManag'>Gestión de Reportes</a>
				</div>

			</li>
			<li class="nav-item dropdown" style="position: absolute; right: 120px">

				<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink3" data-toggle="dropdown"
					aria-haspopup="true" aria-expanded="false"> <img src="\images\user.png" width="30" height="30">
					Sesión
				</a>
				<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
					<a class="dropdown-item">
						<p id="user" style="color: black"></p>
					</a>
					<script>
						document.getElementById("user").innerHTML = "<%=sesion.nameUser%>";
					</script>
					<a class="dropdown-item" href="/passChange">Cambiar Contraseña</a>
					<script>
						function logout() {
							Swal.fire({
								title: '¿Estás seguro de que quieres cerrar sesión?',
								icon: 'warning',
								showCancelButton: true,
								confirmButtonColor: '#3085d6',
								cancelButtonColor: '#d33',
								cancelButtonText: 'Cancelar',
								confirmButtonText: 'Confirmar'
							}).then((result) => {
								if (result.value) {
									let timerInterval;
									Swal.fire({
										title: 'Hasta la próxima!',
										timer: 2000,
										timerProgressBar: true,
										onBeforeOpen: () => {
											Swal.showLoading()
											timerInterval = setInterval(() => {
												const content = Swal.getContent()
												if (content) {
													const b = content.querySelector('b')
													if (b) {
														b.textContent = Swal.getTimerLeft()
													}
												}
											}, 100)
										},
										onClose: () => {
											clearInterval(timerInterval)
										}
									}).then((result) => {
										/* Read more about handling dismissals below */
										if (result.dismiss === Swal.DismissReason.timer) {
											console.log('Message was closed by the timer')
										}
									});
									window.location = '/';
								}
							})
						}
					</script>
					<a class="dropdown-item" onclick="logout()" style="cursor:pointer">Cerrar Sesión</a>
				</div>
			</li>
		</ul>
	</div>
	<script>

		var tipoUsuario = '<%= sesion.typeUser%>'; //acá va el tipo de usuario que puede ser int
		var nav1 = document.getElementById('navInv');
		var nav2 = document.getElementById('navVen');
		var nav3 = document.getElementById('navAdm');
		if (tipoUsuario == 'administrador') { //envés de admin puede ser el int

			nav1.style.display = 'block';
			nav2.style.display = 'block';
			nav3.style.display = 'block';


		} else {
			if (tipoUsuario == 'ventas') {
				nav1.style.display = 'none';
				nav2.style.display = 'block';
				nav3.style.display = 'none';

			} else { //es Inventario
				nav1.style.display = 'block';
				nav2.style.display = 'none';
				nav3.style.display = 'none';
			}

		}
	</script>
</nav>

<body>
	<% if(resultado != ""){ %>
	<div class="container" align="center" style="width: 550px; height: 70px">
		<div class="alert alert-<%=restipo%>">
			<strong>Alerta </strong>: <%=resultado%>
		</div>
	</div>
	<% } %>
	<div class="modal-dialog" role="document">
		<div class="modal-content bg-dark" style="color: white">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLongTitle">Cambiar contraseña</h5>

			</div>
			<div class="modal-body" align="right">

				<div class="container" align="center">

					<form action="/passChange" method="post">
						<input type="hidden" class="form-control" id="rutUser" name="rutUser"
							value="<%= sesion.userID%>">
						<label for="oldpwd"> Escriba contraseña anterior: </label>
						<input type="password" class="form-control" id="oldpwd" name="oldpwd" maxlength=8; minlength=4;
							placeholder="*********" required>
						<label for="newpwd"> Nueva Contraseña </label>
						<input type="password" class="form-control" id="pwd" onchange="comprobar1()" maxlength=8;
							minlength=4; name="newpwd" placeholder="*********" required>
						<label for="confwd"> Confirmar Nueva Contraseña </label>
						<input type="password" class="form-control" id="confpwd" name="confpwd" maxlength=8;
							minlength=4; onchange="comprobar2()" placeholder="*********" required>

						<div class="container" id="isLogin2" align="right" style="padding: 5px">
							<input type="submit" class="btn btn-info" id="isLogin" onclick="" value="Confirmar">

						</div>

					</form>

				</div>


			</div>

		</div>
	</div>


	<img src="\images\Squawksparrot.png" alt=""
		style="position:absolute; top: 100px; left: 10px;width:340px;height:282px;">
	<img src="\images\Klaptrap.png" alt="" style="position:absolute; top: 360px;right: 15px;width:340px;height:223px;">
	<!-- > <button type="button" href="C:\Users\Sepy\Desktop\SantaFeria\src\views\hola.html" style="position: absolute; top: 120px; left: 20px;color: transparent; background-color: transparent; border-color: transparent;"> -->
</body>
<footer class="foo footer-dark bg-dark">
	<div class="footer-copyright text-center py-1">© 2020 Copyright:
		<a> SantaFeria</a>
	</div>
	<!-- Copyright -->

</footer>

</html>